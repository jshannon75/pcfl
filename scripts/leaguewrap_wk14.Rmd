---
title: 'PCFL: Week 14 (and regular season) wrap-up'
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(knitr)
library(lubridate)

weeks<-read_csv("data/week_dates.csv") %>%
  filter(mdy(Date) > today()) %>%
  filter(mdy(Date)==min(mdy(Date)))
week_sel<-weeks$Week


#knitr::opts_knit$set(root.dir = "C:/Users/jshannon/Dropbox/Jschool/Other/pcfl2020")
schedule<-read_csv("data/league_schedule.csv")
team_list<-read_csv("data/league_roster.csv")
players<-read_csv(paste("data/players_wk",week_sel,".csv",sep=""))
recent_adds<-read_csv(paste("data/recent_adds_wk",week_sel,".csv",sep=""))
last_week<-read_csv(paste("data/wk",week_sel,".csv",sep=""))
benchpoints<-read_csv(paste("data/benchpoints_wk",week_sel,".csv",sep=""))
stand_tbl<-read_csv(paste("data/stand_tbl_wk",week_sel,".csv",sep=""))
toppoints<-read_csv(paste("data/toppoints_wk",week_sel,".csv",sep=""))
results<-read_csv(paste("data/results_wk",week_sel,".csv",sep=""))

nextweek_long<-schedule %>%
  filter(week==week_sel) %>%
  mutate(gameid=row_number()) %>%
  pivot_longer(away_id:home_id,
               names_to="awayhome",
               values_to="teamId") %>%
  left_join(team_list %>% 
              select(teamId,fullname)) %>%
  left_join(stand_tbl %>%
              select(fullname,points_scored)) %>%
  select(-teamId) 

nextweek<-nextweek_long %>%
  filter(awayhome=="away_id") %>%
  rename(away_team=fullname,
         away_points=points_scored) %>%
  left_join(nextweek_long %>%
              filter(awayhome=="home_id") %>%
              select(-awayhome) %>%
              rename(home_team=fullname,
                     home_points=points_scored)) %>%
  mutate(range=abs(away_points-home_points)) %>%
  select(-gameid,-awayhome) 

```

### Last week's games

```{r, echo=FALSE}
kable(last_week %>%
        rename(Away=away_team,
               `Away points`=awaypoints,
               Home=home_team,
               `Home points`=homepoints))
```

This was the last week of the regular season, and the stakes were pretty low. Brian ended up with another very nice week in the win over the First Timers, and all three other playoff teams (Sasquatch, Peanuts, and the GOAT) all topped 100 points, as did Christine (who probably wishes those points came last week).

#### Best performing players

Here's last week's **10 best performing players.** 

```{r,echo=FALSE}
kable(top_n(players %>% 
              select(name,points,fullname),10,points) %>%
        rename(Player=name,
               Points=points,
               Team=fullname) %>%
        arrange(-Points))
```

Derrick Henry has been an anchor for Captain Clairvoyant, and he had another great week last week. For those of you who missed the end of the Baltimore game, Lamar Jackson had a memorable moment. (You can just Google his name.) 

#### Best addition and worst starters
There were `r nrow(recent_adds)` players added last week. Which was the **best new addition**?

```{r,echo=FALSE}
kable(recent_adds %>% 
        select(add_date,name,points,fullname) %>%
        rename(`Date added`=add_date,
               Name=name,
               Points=points,
               Team=fullname) %>%
        arrange(-Points))
```

Mike Davis and Cam Akers both had nice weeks running the ball, and Jalen Hurts cleaned up in his first start. Not a whole lot of pickups this week otherwise.

Who won the **best scoring bench** award last week?

```{r,echo=FALSE}
kable(benchpoints %>% arrange(-points)%>%
  rename(Team=fullname,Points=points)) 
```

Gopers made the top of the list this week.

### League standings and season stats
Here's a look at our *final* regular season standings!

```{r, echo=FALSE}
kable(stand_tbl %>%
        rename(Team=fullname,
               Division=division,
               `Points scored`=points_scored,
               `Points allowed`=points_allowed,
               `Points rank`=points_rank,
               `Playoff rank`=playoff_rank))
```

Here's our current awards leaders from these standings:

* Yellow shirt (most points): Georgia Peanuts
* D-FENCE (least points allowed): Southern Sharks *new*
* Tough luck (points rank - playoff rank): Hobbits (6th in points and 10th in the standings)
* Lucky ducks (playoff rank - points rank): A whole bunch of teams ended up here-GOAT, First Timers, Pigskin, Sharks, and Jaheims--all one spot higher in the playoffs than their points would suggest.

I'll also note the parity here--four teams ended up 5-9 and the Hobbits were 4-10.

Here's a list of the **top five scoring performances** so far this season.

```{r, echo=FALSE}
kable(toppoints %>%
        rename(Team=fullname,
               Week=week,
               `Points scored`=points_scored,
               Result=result))
```

The Peanuts held onto the top spot here, but Brian's Captain Clairvoyant also had a strong run at the end. The First Timers' week 2 performance rounds out our top 5.

Lastly, here's a look at the **points trendline** for each team.

```{r, echo=FALSE, message=FALSE}
teamtrend<-results %>%
  select(awayteam,awaypoints,week) %>%
  rename(teamId=awayteam,
         points=awaypoints) %>%
  bind_rows(results %>%
              select(hometeam,homepoints,week) %>%
              rename(teamId=hometeam,
                     points=homepoints)) %>%
  mutate(week=factor(week,levels=c(1,2,3,4,5,6,7,8,9,10,11, 12,13,14))) %>%
  left_join(team_list %>%
              select(teamId,fullname))

ggplot(teamtrend,aes(x=week,y=points,group=fullname))+
  geom_line()+
  geom_point(col="red")+
  #geom_smooth()+
  facet_wrap(~fullname)
```

### Playoffs--week 1

Here's where things get interesting. The playoffs start this week. In some ESPN leagues, each matchup is two weeks long, but that gets to be pretty stretched out. So our league is a one and done over two weeks.

In the championship bracket, this week's matchups are: 

* #1 Peanuts vs. #4 GOAT
* #2 Clairvoyant vs. #3 Sasquatch

The winners advance to the championship matchup. 

In the consolation rounds, the matchups are as follows:

* #5 Gophers vs. #6 First Timers
* #7 Pigskin vs. #8 Sharks
* #9 Jaheims vs. #10 Hobbits

Next week's matchups are more complicated here, but winning is better.

We're nearing the end, y'all. Good luck to everyone!
