---
title: 'PCFL: Week 13 wrap-up'
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(knitr)
library(lubridate)

weeks<-read_csv("data/week_dates.csv") %>%
  filter(mdy(Date) > today()) %>%
  filter(mdy(Date)==min(mdy(Date)))
week_sel<-weeks$Week


#knitr::opts_knit$set(root.dir = "C:/Users/jshannon/Dropbox/Jschool/Other/pcfl2020")
schedule<-read_csv("data/league_schedule.csv")
team_list<-read_csv("data/league_roster.csv")
players<-read_csv(paste("data/players_wk",week_sel,".csv",sep=""))
recent_adds<-read_csv(paste("data/recent_adds_wk",week_sel,".csv",sep=""))
last_week<-read_csv(paste("data/wk",week_sel,".csv",sep=""))
benchpoints<-read_csv(paste("data/benchpoints_wk",week_sel,".csv",sep=""))
stand_tbl<-read_csv(paste("data/stand_tbl_wk",week_sel,".csv",sep=""))
toppoints<-read_csv(paste("data/toppoints_wk",week_sel,".csv",sep=""))
results<-read_csv(paste("data/results_wk",week_sel,".csv",sep=""))

nextweek_long<-schedule %>%
  filter(week==week_sel) %>%
  mutate(gameid=row_number()) %>%
  pivot_longer(away_id:home_id,
               names_to="awayhome",
               values_to="teamId") %>%
  left_join(team_list %>% 
              select(teamId,fullname)) %>%
  left_join(stand_tbl %>%
              select(fullname,points_scored)) %>%
  select(-teamId) 

nextweek<-nextweek_long %>%
  filter(awayhome=="away_id") %>%
  rename(away_team=fullname,
         away_points=points_scored) %>%
  left_join(nextweek_long %>%
              filter(awayhome=="home_id") %>%
              select(-awayhome) %>%
              rename(home_team=fullname,
                     home_points=points_scored)) %>%
  mutate(range=abs(away_points-home_points)) %>%
  select(-gameid,-awayhome) 

```

### Last week's games

```{r, echo=FALSE}
kable(last_week %>%
        rename(Away=away_team,
               `Away points`=awaypoints,
               Home=home_team,
               `Home points`=homepoints))
```

This was a week of pretty decisive wins. The premier matchup of the week was Jacob and Christine, and the GOAT lived up to its name, decisively clinching the last playoff spot. Brian decided to give his players a rest this week in our playoff warmup, but my Peanuts play every week like it's the last one. Erin and Trav, Evan, and Robbie also came out victorious. 

#### Best performing players

Here's last week's **10 best performing players.** 

```{r,echo=FALSE}
kable(top_n(players %>% 
              select(name,points,fullname),10,points) %>%
        rename(Player=name,
               Points=points,
               Team=fullname) %>%
        arrange(-Points))
```

There's not many weeks where a tight end leads the scoring, but Darren Waller's 39 points helped offset a disappointing QB performance on my team. The normal mix of quarterbacks (Carr, Allen, Tannehill, Stafford, Jackson, and Goff) showed up again this week. My Chicago roots got tingled by David Montgomery's good week as well. Lots of high scoring players!

#### Best addition and worst starters
There were `r nrow(recent_adds)` players added last week. Which was the **best new addition**?

```{r,echo=FALSE}
kable(recent_adds %>% 
        select(add_date,name,points,fullname) %>%
        rename(`Date added`=add_date,
               Name=name,
               Points=points,
               Team=fullname) %>%
        arrange(-Points))
```

I won't lie. I had to look up Keke Coutee to see if he was a real person. He had a top 10 week off waivers, y'all, and he came through for the GOAT this week.

Who won the **best scoring bench** award last week?

```{r,echo=FALSE}
kable(benchpoints %>% arrange(-points)%>%
  rename(Team=fullname,Points=points)) 
```

Lots of high scoring benches, but the First Timers made the top of the list.

### League standings and season stats
Here's a look at our current standings

```{r, echo=FALSE}
kable(stand_tbl %>%
        rename(Team=fullname,
               Division=division,
               `Points scored`=points_scored,
               `Points allowed`=points_allowed,
               `Points rank`=points_rank,
               `Playoff rank`=playoff_rank))
```

Here's our current awards leaders from these standings:

* Yellow shirt (most points): Georgia Peanuts
* D-FENCE (least points allowed): Georgia Peanuts
* Tough luck (points rank - playoff rank): Hobbits (6th in points and 9th in the standings)
* Lucky ducks (playoff rank - points rank): KC Gophers (*new*) (7th in points but 5th in the standings)

Here's a list of the **top five scoring performances** so far this season.

```{r, echo=FALSE}
kable(toppoints %>%
        rename(Team=fullname,
               Week=week,
               `Points scored`=points_scored,
               Result=result))
```

The Peanuts turned in a top five performance this week.

Lastly, here's a look at the **points trendline** for each team.

```{r, echo=FALSE, message=FALSE}
teamtrend<-results %>%
  select(awayteam,awaypoints,week) %>%
  rename(teamId=awayteam,
         points=awaypoints) %>%
  bind_rows(results %>%
              select(hometeam,homepoints,week) %>%
              rename(teamId=hometeam,
                     points=homepoints)) %>%
  mutate(week=factor(week,levels=c(1,2,3,4,5,6,7,8,9,10,11, 12,13,14))) %>%
  left_join(team_list %>%
              select(teamId,fullname))

ggplot(teamtrend,aes(x=week,y=points,group=fullname))+
  geom_line()+
  geom_point(col="red")+
  #geom_smooth()+
  facet_wrap(~fullname)
```

### Playoff picture

Not much to say here at this point. The four playoff teams are Brian, Robbie, Jacob, and me. The rest of the league is all within two games of each other, so the consolation brackets are still very much up for grabs. I'll have a full round up next week.

## Next week's games

Here's a quick summary of next week's matchups:

```{r,echo=FALSE}
kable(nextweek)
```

The stakes are relatively low this week. Both Scott and Evan have had disappointing seasons, and they face each other this week in a battle for last place. Christine currently has the top consolation seeding, but a loss to Richard could put that in jeopardy, as Erin and Trav could slide into that spot with a win over Brian. Good luck all!